#!/usr/bin/env bash

sessionname="xen"

# reattach if running
tmux ls | grep -q ^$sessionname:
isrunning=$?

if [ $isrunning -eq 1 ] # false
then
	tmux new-session -d -s $sessionname
	i=2 
	#tmux new-window -t $sessionname:$i -n "$(hostname)" '/bin/bash'
	#i=$(( $i+1 ))
	for domu in $(sudo xm list --state=running | cut -f1 -d' ' | grep -v "Name\|Domain-0")
	do
		tmux new-window -t $sessionname:$i -n "$domu" "sudo xm console $domu"
		i=$(( $i+1 ))
	done
	tmux select-window -t $sessionname:1
fi
tmux -2 attach-session -t $sessionname
